---
title: "Condition of Lake Erie Largemouth Bass Sampled in the ODOW Nearshore Community Survey 2013-2017"
author: "Alex Benecke"
date: "January 4, 2018"
output: pdf_document
header-includes:
    - \setlength\parindent{24pt}
    - \usepackage{indentfirst}
editor_options: 
  chunk_output_type: console
---

### Data Prep

```{r setup and load packages, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(FSA)
library(car) ## befor dplyr reduce conflicts with MASS
library(dplyr)
library(plotrix)
library(multcomp)
library(tidyverse)
library(magrittr)
library(Matching)
```

```{r Load Data, results='hide'}
Stock <- read.csv("Data/Clean-Data/largemouth-bass_Wr_Stock.csv") %>% 
  filter(Length>=200) %>%
  filter(Year<2017) %>%
  filterD(!is.na(Wr)) %>%
  arrange(Year,gcat)


Stock$fyr <- factor(Stock$fyr)
Stock$Year <- factor(Stock$Year)
```
```{r View Data, tidy=TRUE}
headtail(Stock)
str(Stock)
unique(Stock$fyr)
```

  **Note**
  
  *I removed the years 2012 and 2017. 2012 because only large fish have weight length data and more and differenct sites were samples. I removed 2017 due to differences in the survey.*
  
  **Note**
  
  *I am removing a fish from site 15 year 2013 because it appears to be a outlier (Wr > 200). Probably due to data entry error.*
```{r Remove outlier, results='hide}
nrow(Stock)
(Where.r.u <- Stock[Stock$Weight==1714,]) ## row 43
(rm.outlier <- as.numeric(row.names(Stock[Stock$Weight==1714,])))


Stock <- Stock[-c(rm.outlier),] %>%
  filter(!is.na(Wr))
str(Stock)
headtail(Stock)
```

  
\newpage

### Summarize Relative Weight by Year

```{r Summarizing Wr Data for 2012,2014,2015,2016, tidy=TRUE}
(Wr.Stock <- Summarize(Wr~Year,data = Stock) %>%
  arrange(Year))
```


**Note**

  *The relative weight data contains only stock length individuals. This is so that I can easily compare the relative weight of fish with PSD. This is done despite the min TL being 150 mm. I may want to summarize relative weight for 150mm and greater length individuals in the future to see if young/small fish drive down or increase Wr.*


Lets start exploring the relative weight data. I have two questions I would like to know the answer to.

1) does Wr differ among years?

2) does Wr differ among gabelhouse length categories?


**First** Lets see if Wr is different between years. 

```{r Anova Wr Year, tidy=TRUE}
aov1 <- lm(Wr~Year,data=Stock)
#save(aov1,file = "model-output/aov1.rda")
Anova(aov1)

mc1 <- glht(aov1,mcp(Year="Tukey"))
summary(mc1)
```


  Looks like Wr *is significantly different* between years (One-Way ANOVA, $F_{3, 406}$ = 4.00, p = 0.007933). There is *no significant difference* in relative weight between
  2013 and 2014 (Tukey HSD, t = -1.94, p = 0.2102),
  2013 and 2015 (Tukey HSD, t = -1.52, p = 0.4241),
  2013 and 2016 (Tukey HSD, t = 1.02, p = 0.7346), 
  2015 and 2014 (Tukey HSD, t = 0.102, p = 0.9996), and 
  2015 and 2016 (Tukey HSD, t = 2.47, p = 0.0662). However, relative weight *is significantly different* between 
  2014 and 2016 (Tukey HSD, t = 3.11, p = 0.0110).


### constructing a plot of Wr and Year

```{r Create Results to be plotted, tidy=TRUE}
grps.1 <- c("2013", "2014", "2015", "2016")
nd.1 <- data.frame(Year=factor(grps.1,levels = grps.1))
(pred.1 <- predict(aov1,nd.1,interval = "confidence"))
```

```{r Plot Wr by Year, tidy=TRUE}
plotCI(as.numeric(nd.1$Year), pred.1[,"fit"],
       li = pred.1[,"lwr"], ui = pred.1[,"upr"],
       pch=19, xaxt = "n", 
       xlim = c(0.8, 4.2), ylim = c(79,121),
       xlab = "Year", ylab = "Mean Wr")

lines(nd.1$Year, pred.1[,"fit"],col="gray50")

axis(1,at=nd.1$Year, labels = nd.1$Year)

cld(mc1)

text(x=nd.1$Year, y=pred.1[,"upr"], labels = c("ab", "a", "ab", "b"), pos=3)

abline(h=100,lty=4,col="green")
```


```{r Testing Assumptions, tidy=TRUE}
residPlot(aov1)
leveneTest(aov1) # Pitential outlier line 43
# 2013 site 15 Weight = 1714 Length = 368 Wr > 200
```

  Variance are equal and the homoscedasticity assumption is likley met (Levene's Test, $F_{3, 406}$ = 1.5423, p = 0.203). 

  **Without 2017** *Variance are equal and the homoscedasticity assumption is likley met (Levene's Test, $F_{2, 311}$ = 1.75, p = 0.18).*


```{r real quick make Wr.csv from pred, tidy=TRUE}
Year <- c("2013", "2014", "2015", "2016")
pred.1 <- data.frame(Year,pred.1)
names(pred.1) <- c("Year", "Wr", "LCI", "UCI")
str(pred.1)
head(pred.1)
#2-9-2018#write.csv(pred.1,file = "Data/Clean-Data/summary-data/relative-weight_largemouth-bass_STOCK.csv",row.names = FALSE)
```


### To Be Continued...

  I will look into the difference in Wr between gcat at a later date. I don't think this matters so much as of now.


```{r, tidy=TRUE}
Wr.14 <- filterD(Stock,Year==2014)
Wr.15 <- filterD(Stock,Year==2015)
Wr.16 <- filterD(Stock,Year==2016)
```